<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>Document</title>
 </head>
 <style>
 *{margin:0;padding:0;}
body{background:#464547;}
ul{list-style-type:none;}

#outer{width:500px;height:850px;background:#fffef9;margin:10px auto;border-radius:8px;padding:5px;}
#title{font:500 20px/1.5 Arial;margin-left:20px;margin-top:10px;}
#usernameField{width:140px;height:26px;margin-top:10px;margin-left:20px;border:1px solid #a1a3a6;border-radius:5px;opacity:0.6;font:500 16px/1.5 Arial;padding:2px;font-style:italic;}
#portrait li{float:left;position:relative;top:-35px;left:180px;}
#portrait li img{margin:3px;width:35px;height:35px;border-radius:3px;cursor:pointer;opacity:0.4;filter:alpha(opacity=40);}
#portrait li img.current{opacity:1;border:1px solid #76becc;}
#portrait li img:hover{border:1px solid #76becc;opacity:1;filter:alpha(opacity=100);}

#content{width:450px;height:80px;position:relative;left:20px;top:-30px;border-radius:7px;border:1px solid #999d9c;font:500 16px/1.5 Arial;padding:5px;opacity:0.7;resize:none;font-style:italic;}
.broadcast{width:450px;height:40px;position:relative;left:20px;top:-30px;padding:5px;}
.broadcast span{font:14px/1.5 Georgia;float:right;margin-right:15px;}
.broadcast span b{font:500 21px/1.5 Georgia;}
.broadcast em{font:14px/1.5 Georgia;}
.broadcast #button{float:right;width:120px;height:35px;border:1px solid #65c294;border-radius:5px;font:600 20px/1.5 Arial;background:#1d953f;margin-right:-5px;color:white;}
#button:hover{background:#45b97c;cursor:pointer;}

#outer .weiboList{position:relative;width:460px;height:550px;top:-20px;left:20px;}
#outer .weiboList h3{display:block;width:460px;height:30px;background:#cde6c7;}
#outer .weiboList h3 span{display:block;width:90px;height:25px;background:#fffffb;text-align:center;font:500 16px/1.8 Arial;position:relative;top:5px;left:15px;}
#outer .weiboList ul{width:460px;overflow:hidden;zoom:1;}
#outer .weiboList ul li{float:left;clear:both;width:460px;border-bottom:1px dashed #d8d8d8;padding:10px 0;background:#fff;overflow:hidden;}
#outer .weiboList ul li:hover{background:#f5f5f5;}
#outer .weiboList .userPic{float:left;width:50px;height:50px;display:inline;margin-left:10px;border:1px solid #ccc;border-radius:3px;}
#outer .weiboList .userPic img{width:50px;height:50px;display:inline;cursor:pointer;}
#outer .weiboList .content{float:left;width:360px;font-size:14px;margin-left:10px;font-family:arial;word-wrap:break-word;}
#outer .weiboList .userName{display:inline;padding-right:5px;}
#outer .weiboList .userName a{color:#2b4a78;text-decoration:none;}
#outer .weiboList .msgInfo{display:inline;word-wrap:normal;}
#outer .weiboList .times{color:#889db6;font:12px/18px arial;margin-top:15px;overflow:hidden;zoom:1;}
#outer .weiboList .times span{float:left;}
#outer .weiboList .times a{float:right;color:#889db6;display:none;text-decoration:none;}
 </style>
<script>
/*-------------------------- +
  获取id, class, tagName
 +-------------------------- */
 var get={
        byId:function(id){
                return typeof id == "string" ? document.getElementById(id) : id;
        },
        byClass:function(sClass, oParent){
                var aClass = [];
                var reClass = new RegExp("(^|)"+sClass+"(|$)");
                var aElem = this.byTagName('*',oParent);
                for(var i =0; i<aElem.length;i++){
                        reClass.test(aElem[i].className) && aClass.push(aElem[i]);
                }
                return aClass;
        },
        byTagName:function(elem,obj){
                return (obj||document).getElementsByTagName(elem);
        }
 };
 /*-------------------------- +
  事件绑定, 删除
 +-------------------------- */
var EventUtil = {
        addHandler: function (oElement, sEvent, fnHandler) {
                oElement.addEventListener ? oElement.addEventListener(sEvent, fnHandler, false) : (oElement["_" + sEvent + fnHandler] = fnHandler, oElement[sEvent + fnHandler] = function () {oElement["_" + sEvent + fnHandler]()}, oElement.attachEvent("on" + sEvent, oElement[sEvent + fnHandler]))
        },
        removeHandler: function (oElement, sEvent, fnHandler) {
                oElement.removeEventListener ? oElement.removeEventListener(sEvent, fnHandler, false) : oElement.detachEvent("on" + sEvent, oElement[sEvent + fnHandler])
        },
        addLoadHandler: function (fnHandler) {
                this.addHandler(window, "load", fnHandler)
        }
};
/*-------------------------- +
  设置css样式
  读取css样式
 +-------------------------- */
 function css(obj,attr,value){
        switch(arguments.length){
                case 2:
                        if(typeof arguments[1] == 'object'){
                                for (var i in attr )
                                {
                                        i == "opacity" ? (obj.style["filter"] = "alpha(opacity=" + attr[i] + ")", obj.style[i] = attr[i] / 100) : obj.style[i] = attr[i];
                                }
                        }
                        else{
                                        return obj.currentStyle ? obj.currentStyle[attr] : getComputedStyle(obj , null)[attr];
                                }
                                break;
                case 3:
                        attr == "opacity" ? (obj.style["filter"] = "alpha(opacity=" + value + ")", obj.style[attr] = value / 100) : obj.style[attr] = value;
                        break;
        }
 }
window.onload = function(){
        
        var oContent = document.getElementById("content");
        var oUserNameField = document.getElementById("usernameField");
        var oOuter = get.byId("outer");
        var oUserNameField = get.byId("usernameField");
        var oContent = get.byId("content");
        var oButton = get.byId("button");
        var oMaxNum = get.byClass("maxNum")[0];
        var oCountTxt = get.byClass("countTxt")[0];
        var oWeiboList = get.byClass("weiboList")[0];
        var oUl = get.byTagName("ul", oWeiboList)[0];
        var aLi = get.byTagName("li", oWeiboList);
        var aFtxt = get.byClass("f-text", oOuter);
        var aPortrait = get.byTagName("img",get.byId("portrait"));
        var bSend = false;
        var timer = null;
        var oTmp = "";
        var i = 0;
        var maxNum = 140;
        oContent.value='现在在想什么呢？赶紧写下来吧～';
        /*- - - - - - - - - -  - - - - - - 
                输入框字体预览
         - - - - - - - - - - - - - - - - - */
        oUserNameField.onfocus = function(){
                if(this.value ==''|| this.value =='请输入用户名'){
                        this.value = '';
                        this.style.fontStyle='normal';
                }
                oUserNameField.style.opacity = '1';
        }
        oUserNameField.onblur = function(){
                if(this.value == ''|| this.value == '请输入用户名'){
                        this.value = '请输入用户名';
                        this.style.fontStyle='italic';
                }
                oUserNameField.style.opacity = '0.6';
        }
        oContent.onfocus = function(){
                if(this.value =='' || this.value =='现在在想什么呢？赶紧写下来吧～'){
                        this.value = '';
                        this.style.fontStyle='normal';
                }
        }
        oContent.onblur = function(){
                if(this.value == '' || this.value == '现在在想什么呢？赶紧写下来吧～'){
                        this.value = '现在在想什么呢？赶紧写下来吧～';
                        this.style.fontStyle='italic';
                }
        }
        //禁止表单提交
        //EventUtil.addHandler(get.byTagName("form", oOuter)[0], "submit", function () {return false});

        //为广播按钮绑定发送事件
        EventUtil.addHandler(oButton, "click", fnSend);

        //为Ctrl+Enter快捷键绑定发送事件
        EventUtil.addHandler(document, "keyup", function(event)
        {
                var event = event || window.event;
                event.ctrlKey && event.keyCode == 13 && fnSend()
        });

        //点击广播按钮
        function fnSend(){
                var reg = /^\s*$/g;
                if(reg.test(oUserNameField.value)||oUserNameField.value =='请输入用户名'){
                        alert("请填写您的用户名.");
                        oUserNameField.focus();
                }
                else if(!/^[u4e00-\u9fa5\w]{2,8}$/g.test(oUserNameField.value))
                {
                        //姓名由2-8位字母、数字、下划线、汉字组成！
                        alert("\u59d3\u540d\u75312-8\u4f4d\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u3001\u6c49\u5b57\u7ec4\u6210\uff01");
                        oUserNameField.focus()
                }
                else if(reg.test(oContent.value)||oContent.value == '现在在想什么呢？赶紧写下来吧～')
                {
                        //随便说点什么吧
                        alert("\u968f\u4fbf\u8bf4\u70b9\u4ec0\u4e48\u5427\uff01");
                        oContent.focus();
                }
                else if(!bSend)
                {
                        //姓名由2-8位字母、数字、下划线、汉字组成！
                        alert("\u4f60\u8f93\u5165\u7684\u5185\u5bb9\u5df2\u8d85\u51fa\u9650\u5236\uff0c\u8bf7\u68c0\u67e5\uff01");
                        oContent.focus();
                }
                else{
                        var oLi = document.createElement("li");
                        var oDate = new Date();
                        oLi.innerHTML  = "<div class=\"userPic\"><img src=\""+ get.byClass("current", get.byId("portrait"))[0].src + "\"></div>\
                                                         <div class=\"content\">\
                                                                 <div class=\"userName\"><a href=\"javascript:;\">" + oUserNameField.value + "</a>:</div>\
                                                                <div class=\"msgInfo\">" + oContent.value.replace(/<[^>]*>| /ig, "") + "</div>\
                                                                <div class=\"times\"><span>" + format(oDate.getMonth() + 1) + "\u6708" + format(oDate.getDate()) + "\u65e5 " + format(oDate.getHours()) + ":" + format(oDate.getMinutes()) + "</span><a class=\"del\" href=\"javascript:;\">\u5220\u9664</a></div>\
                                                         </div>";

                        //插入元素
                        aLi.length ? oUl.insertBefore(oLi, aLi[0]) : oUl.appendChild(oLi);
                        
                        //重置表单
                        get.byTagName("form", oOuter)[0].reset();
                        for (i = 0; i < aPortrait.length; i++) aPortrait[i].className = "";
                        aPortrait[0].className = "current";

                        //将元素高度保存
                        var iHeight = oLi.clientHeight - parseFloat(css(oLi, "paddingTop")) - parseFloat(css(oLi, "paddingBottom"));
                        var alpha = count = 0 ;
                        css(oLi, {"opacity" : "0", "height" : "0"});        
                        var boxHeight = oOuter.offsetHeight;
                        timer = setInterval(function(){
                                if(oOuter.offsetHeight >=850 &&aLi.length >7){
                                        
                                        css(oOuter,{"height" : (boxHeight +=9)+"px"});
                                }
                                css(oLi,{"display" : "block" , "opacity" : "0" , "height" :(count+=8)+"px"});                    
                                if(count >iHeight)
                                {
                                        clearInterval(timer);
                                        css(oLi , iHeight+"px");
                                        timer = setInterval(function()
                                        {
                                                css(oLi ,"opacity",(alpha +=10));
                                                alpha > 100 &&(clearInterval(timer)),css(oLi,"opacity",100);
                                        },30);
                                }
                        },30);
                        //调用鼠标划过/离开样式
                        liHover();
                        //调用删除函数
                        delLi();
                        //把输入字数清零，显示140字
                        confine(); 

                        oContent.value='现在在想什么呢？赶紧写下来吧～';
                }
        }
        //事件绑定, 判断字符输入
        EventUtil.addHandler(oContent, "keyup", confine);        
        EventUtil.addHandler(oContent, "focus", confine);
        EventUtil.addHandler(oContent, "change", confine);

        //输入字符限制
        function confine ()
        {
                var iLen = 0;                
                for (i = 0; i < oContent.value.length; i++) iLen += /[^\x00-\xff]/g.test(oContent.value.charAt(i)) ? 1 : 0.5;
                oMaxNum.innerHTML = Math.abs(maxNum - Math.floor(iLen));        
                maxNum - Math.floor(iLen) >= 0 ? (css(oMaxNum, "color", ""), oCountTxt.innerHTML = "\u8fd8\u80fd\u8f93\u5165", bSend = true) : (css(oMaxNum, "color", "#ed1941"), oCountTxt.innerHTML = "\u5df2\u8d85\u51fa", bSend = false)
        }
        //加载即调用
        confine();        

        function liHover()
        {
                for (i = 0; i < aLi.length; i++)
                {
                        //li鼠标划过样式
                        EventUtil.addHandler(aLi[i], "mouseover", function (event)
                        {
                                oTmp = get.byClass("times", this)[0];
                                var aA = get.byTagName("a", oTmp);
                                if (!aA.length)                //当不存在a节点时。
                                {
                                        var oA = document.createElement("a");                                        
                                        oA.innerHTML = "删除";
                                        oA.className = "del";
                                        oA.href = "javascript:;";
                                        oTmp.appendChild(oA)
                                }
                                else
                                {
                                        aA[0].style.display = "block";
                                }
                        });

                        //li鼠标离开样式
                        EventUtil.addHandler(aLi[i], "mouseout", function ()
                        {
                                var oA = get.byTagName("a", get.byClass("times", this)[0])[0];
                                oA.style.display = "none"        
                        })
                }
        }
        liHover();
        
        //删除功能
        function delLi()
        {
                var aA = get.byClass("del", oUl);
                
                for (i = 0; i < aA.length; i++)
                {
                        aA[i].onclick = function ()
                        {
                                var oParent = this.parentNode.parentNode.parentNode;            //多个父结点，即li
                                var alpha = 100;
                                var iHeight = oParent.offsetHeight;
                                var boxHeight = oOuter.offsetHeight;
                                timer = setInterval(function ()
                                {
                                        
                                        css(oParent, "opacity", (alpha -= 10));
                                        if (alpha < 0)
                                        {
                                                clearInterval(timer);                                                
                                                timer = setInterval(function ()
                                                {
                                                        if(oOuter.offsetHeight >=860)
                                                        {
                                                                css(oOuter,{"height" : (boxHeight -=11)+"px"});
                                                        }
                                                        iHeight -= 10;
                                                        iHeight < 0 && (iHeight = 0);
                                                        css(oParent, "height", iHeight + "px");
                                                        iHeight == 0 && (clearInterval(timer), oUl.removeChild(oParent))
                                                },30)
                                        }        
                                },30);                        
                                this.onclick = null        
                        }                        
                }
        }
        delLi();

        //格式化时间, 如果为一位数时补0
        function format(str)
        {
                return str.toString().replace(/^(\d)$/,"0]<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>Document</title>
 </head>
 <style>
 *{margin:0;padding:0;}
body{background:#464547;}
ul{list-style-type:none;}

#outer{width:500px;height:850px;background:#fffef9;margin:10px auto;border-radius:8px;padding:5px;}
#title{font:500 20px/1.5 Arial;margin-left:20px;margin-top:10px;}
#usernameField{width:140px;height:26px;margin-top:10px;margin-left:20px;border:1px solid #a1a3a6;border-radius:5px;opacity:0.6;font:500 16px/1.5 Arial;padding:2px;font-style:italic;}
#portrait li{float:left;position:relative;top:-35px;left:180px;}
#portrait li img{margin:3px;width:35px;height:35px;border-radius:3px;cursor:pointer;opacity:0.4;filter:alpha(opacity=40);}
#portrait li img.current{opacity:1;border:1px solid #76becc;}
#portrait li img:hover{border:1px solid #76becc;opacity:1;filter:alpha(opacity=100);}

#content{width:450px;height:80px;position:relative;left:20px;top:-30px;border-radius:7px;border:1px solid #999d9c;font:500 16px/1.5 Arial;padding:5px;opacity:0.7;resize:none;font-style:italic;}
.broadcast{width:450px;height:40px;position:relative;left:20px;top:-30px;padding:5px;}
.broadcast span{font:14px/1.5 Georgia;float:right;margin-right:15px;}
.broadcast span b{font:500 21px/1.5 Georgia;}
.broadcast em{font:14px/1.5 Georgia;}
.broadcast #button{float:right;width:120px;height:35px;border:1px solid #65c294;border-radius:5px;font:600 20px/1.5 Arial;background:#1d953f;margin-right:-5px;color:white;}
#button:hover{background:#45b97c;cursor:pointer;}

#outer .weiboList{position:relative;width:460px;height:550px;top:-20px;left:20px;}
#outer .weiboList h3{display:block;width:460px;height:30px;background:#cde6c7;}
#outer .weiboList h3 span{display:block;width:90px;height:25px;background:#fffffb;text-align:center;font:500 16px/1.8 Arial;position:relative;top:5px;left:15px;}
#outer .weiboList ul{width:460px;overflow:hidden;zoom:1;}
#outer .weiboList ul li{float:left;clear:both;width:460px;border-bottom:1px dashed #d8d8d8;padding:10px 0;background:#fff;overflow:hidden;}
#outer .weiboList ul li:hover{background:#f5f5f5;}
#outer .weiboList .userPic{float:left;width:50px;height:50px;display:inline;margin-left:10px;border:1px solid #ccc;border-radius:3px;}
#outer .weiboList .userPic img{width:50px;height:50px;display:inline;cursor:pointer;}
#outer .weiboList .content{float:left;width:360px;font-size:14px;margin-left:10px;font-family:arial;word-wrap:break-word;}
#outer .weiboList .userName{display:inline;padding-right:5px;}
#outer .weiboList .userName a{color:#2b4a78;text-decoration:none;}
#outer .weiboList .msgInfo{display:inline;word-wrap:normal;}
#outer .weiboList .times{color:#889db6;font:12px/18px arial;margin-top:15px;overflow:hidden;zoom:1;}
#outer .weiboList .times span{float:left;}
#outer .weiboList .times a{float:right;color:#889db6;display:none;text-decoration:none;}
 </style>
<script>
/*-------------------------- +
  获取id, class, tagName
 +-------------------------- */
 var get={
        byId:function(id){
                return typeof id == "string" ? document.getElementById(id) : id;
        },
        byClass:function(sClass, oParent){
                var aClass = [];
                var reClass = new RegExp("(^|)"+sClass+"(|$)");
                var aElem = this.byTagName('*',oParent);
                for(var i =0; i<aElem.length;i++){
                        reClass.test(aElem[i].className) && aClass.push(aElem[i]);
                }
                return aClass;
        },
        byTagName:function(elem,obj){
                return (obj||document).getElementsByTagName(elem);
        }
 };
 /*-------------------------- +
  事件绑定, 删除
 +-------------------------- */
var EventUtil = {
        addHandler: function (oElement, sEvent, fnHandler) {
                oElement.addEventListener ? oElement.addEventListener(sEvent, fnHandler, false) : (oElement["_" + sEvent + fnHandler] = fnHandler, oElement[sEvent + fnHandler] = function () {oElement["_" + sEvent + fnHandler]()}, oElement.attachEvent("on" + sEvent, oElement[sEvent + fnHandler]))
        },
        removeHandler: function (oElement, sEvent, fnHandler) {
                oElement.removeEventListener ? oElement.removeEventListener(sEvent, fnHandler, false) : oElement.detachEvent("on" + sEvent, oElement[sEvent + fnHandler])
        },
        addLoadHandler: function (fnHandler) {
                this.addHandler(window, "load", fnHandler)
        }
};
/*-------------------------- +
  设置css样式
  读取css样式
 +-------------------------- */
 function css(obj,attr,value){
        switch(arguments.length){
                case 2:
                        if(typeof arguments[1] == 'object'){
                                for (var i in attr )
                                {
                                        i == "opacity" ? (obj.style["filter"] = "alpha(opacity=" + attr[i] + ")", obj.style[i] = attr[i] / 100) : obj.style[i] = attr[i];
                                }
                        }
                        else{
                                        return obj.currentStyle ? obj.currentStyle[attr] : getComputedStyle(obj , null)[attr];
                                }
                                break;
                case 3:
                        attr == "opacity" ? (obj.style["filter"] = "alpha(opacity=" + value + ")", obj.style[attr] = value / 100) : obj.style[attr] = value;
                        break;
        }
 }
window.onload = function(){
        
        var oContent = document.getElementById("content");
        var oUserNameField = document.getElementById("usernameField");
        var oOuter = get.byId("outer");
        var oUserNameField = get.byId("usernameField");
        var oContent = get.byId("content");
        var oButton = get.byId("button");
        var oMaxNum = get.byClass("maxNum")[0];
        var oCountTxt = get.byClass("countTxt")[0];
        var oWeiboList = get.byClass("weiboList")[0];
        var oUl = get.byTagName("ul", oWeiboList)[0];
        var aLi = get.byTagName("li", oWeiboList);
        var aFtxt = get.byClass("f-text", oOuter);
        var aPortrait = get.byTagName("img",get.byId("portrait"));
        var bSend = false;
        var timer = null;
        var oTmp = "";
        var i = 0;
        var maxNum = 140;
        oContent.value='现在在想什么呢？赶紧写下来吧～';
        /*- - - - - - - - - -  - - - - - - 
                输入框字体预览
         - - - - - - - - - - - - - - - - - */
        oUserNameField.onfocus = function(){
                if(this.value ==''|| this.value =='请输入用户名'){
                        this.value = '';
                        this.style.fontStyle='normal';
                }
                oUserNameField.style.opacity = '1';
        }
        oUserNameField.onblur = function(){
                if(this.value == ''|| this.value == '请输入用户名'){
                        this.value = '请输入用户名';
                        this.style.fontStyle='italic';
                }
                oUserNameField.style.opacity = '0.6';
        }
        oContent.onfocus = function(){
                if(this.value =='' || this.value =='现在在想什么呢？赶紧写下来吧～'){
                        this.value = '';
                        this.style.fontStyle='normal';
                }
        }
        oContent.onblur = function(){
                if(this.value == '' || this.value == '现在在想什么呢？赶紧写下来吧～'){
                        this.value = '现在在想什么呢？赶紧写下来吧～';
                        this.style.fontStyle='italic';
                }
        }
        //禁止表单提交
        //EventUtil.addHandler(get.byTagName("form", oOuter)[0], "submit", function () {return false});

        //为广播按钮绑定发送事件
        EventUtil.addHandler(oButton, "click", fnSend);

        //为Ctrl+Enter快捷键绑定发送事件
        EventUtil.addHandler(document, "keyup", function(event)
        {
                var event = event || window.event;
                event.ctrlKey && event.keyCode == 13 && fnSend()
        });

        //点击广播按钮
        function fnSend(){
                var reg = /^\s*$/g;
                if(reg.test(oUserNameField.value)||oUserNameField.value =='请输入用户名'){
                        alert("请填写您的用户名.");
                        oUserNameField.focus();
                }
                else if(!/^[u4e00-\u9fa5\w]{2,8}$/g.test(oUserNameField.value))
                {
                        //姓名由2-8位字母、数字、下划线、汉字组成！
                        alert("\u59d3\u540d\u75312-8\u4f4d\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u3001\u6c49\u5b57\u7ec4\u6210\uff01");
                        oUserNameField.focus()
                }
                else if(reg.test(oContent.value)||oContent.value == '现在在想什么呢？赶紧写下来吧～')
                {
                        //随便说点什么吧
                        alert("\u968f\u4fbf\u8bf4\u70b9\u4ec0\u4e48\u5427\uff01");
                        oContent.focus();
                }
                else if(!bSend)
                {
                        //姓名由2-8位字母、数字、下划线、汉字组成！
                        alert("\u4f60\u8f93\u5165\u7684\u5185\u5bb9\u5df2\u8d85\u51fa\u9650\u5236\uff0c\u8bf7\u68c0\u67e5\uff01");
                        oContent.focus();
                }
                else{
                        var oLi = document.createElement("li");
                        var oDate = new Date();
                        oLi.innerHTML  = "<div class=\"userPic\"><img src=\""+ get.byClass("current", get.byId("portrait"))[0].src + "\"></div>\
                                                         <div class=\"content\">\
                                                                 <div class=\"userName\"><a href=\"javascript:;\">" + oUserNameField.value + "</a>:</div>\
                                                                <div class=\"msgInfo\">" + oContent.value.replace(/<[^>]*>| /ig, "") + "</div>\
                                                                <div class=\"times\"><span>" + format(oDate.getMonth() + 1) + "\u6708" + format(oDate.getDate()) + "\u65e5 " + format(oDate.getHours()) + ":" + format(oDate.getMinutes()) + "</span><a class=\"del\" href=\"javascript:;\">\u5220\u9664</a></div>\
                                                         </div>";

                        //插入元素
                        aLi.length ? oUl.insertBefore(oLi, aLi[0]) : oUl.appendChild(oLi);
                        
                        //重置表单
                        get.byTagName("form", oOuter)[0].reset();
                        for (i = 0; i < aPortrait.length; i++) aPortrait[i].className = "";
                        aPortrait[0].className = "current";

                        //将元素高度保存
                        var iHeight = oLi.clientHeight - parseFloat(css(oLi, "paddingTop")) - parseFloat(css(oLi, "paddingBottom"));
                        var alpha = count = 0 ;
                        css(oLi, {"opacity" : "0", "height" : "0"});        
                        var boxHeight = oOuter.offsetHeight;
                        timer = setInterval(function(){
                                if(oOuter.offsetHeight >=850 &&aLi.length >7){
                                        
                                        css(oOuter,{"height" : (boxHeight +=9)+"px"});
                                }
                                css(oLi,{"display" : "block" , "opacity" : "0" , "height" :(count+=8)+"px"});                    
                                if(count >iHeight)
                                {
                                        clearInterval(timer);
                                        css(oLi , iHeight+"px");
                                        timer = setInterval(function()
                                        {
                                                css(oLi ,"opacity",(alpha +=10));
                                                alpha > 100 &&(clearInterval(timer)),css(oLi,"opacity",100);
                                        },30);
                                }
                        },30);
                        //调用鼠标划过/离开样式
                        liHover();
                        //调用删除函数
                        delLi();
                        //把输入字数清零，显示140字
                        confine(); 

                        oContent.value='现在在想什么呢？赶紧写下来吧～';
                }
        }
        //事件绑定, 判断字符输入
        EventUtil.addHandler(oContent, "keyup", confine);        
        EventUtil.addHandler(oContent, "focus", confine);
        EventUtil.addHandler(oContent, "change", confine);

        //输入字符限制
        function confine ()
        {
                var iLen = 0;                
                for (i = 0; i < oContent.value.length; i++) iLen += /[^\x00-\xff]/g.test(oContent.value.charAt(i)) ? 1 : 0.5;
                oMaxNum.innerHTML = Math.abs(maxNum - Math.floor(iLen));        
                maxNum - Math.floor(iLen) >= 0 ? (css(oMaxNum, "color", ""), oCountTxt.innerHTML = "\u8fd8\u80fd\u8f93\u5165", bSend = true) : (css(oMaxNum, "color", "#ed1941"), oCountTxt.innerHTML = "\u5df2\u8d85\u51fa", bSend = false)
        }
        //加载即调用
        confine();        

        function liHover()
        {
                for (i = 0; i < aLi.length; i++)
                {
                        //li鼠标划过样式
                        EventUtil.addHandler(aLi[i], "mouseover", function (event)
                        {
                                oTmp = get.byClass("times", this)[0];
                                var aA = get.byTagName("a", oTmp);
                                if (!aA.length)                //当不存在a节点时。
                                {
                                        var oA = document.createElement("a");                                        
                                        oA.innerHTML = "删除";
                                        oA.className = "del";
                                        oA.href = "javascript:;";
                                        oTmp.appendChild(oA)
                                }
                                else
                                {
                                        aA[0].style.display = "block";
                                }
                        });

                        //li鼠标离开样式
                        EventUtil.addHandler(aLi[i], "mouseout", function ()
                        {
                                var oA = get.byTagName("a", get.byClass("times", this)[0])[0];
                                oA.style.display = "none"        
                        })
                }
        }
        liHover();
        
        //删除功能
        function delLi()
        {
                var aA = get.byClass("del", oUl);
                
                for (i = 0; i < aA.length; i++)
                {
                        aA[i].onclick = function ()
                        {
                                var oParent = this.parentNode.parentNode.parentNode;            //多个父结点，即li
                                var alpha = 100;
                                var iHeight = oParent.offsetHeight;
                                var boxHeight = oOuter.offsetHeight;
                                timer = setInterval(function ()
                                {
                                        
                                        css(oParent, "opacity", (alpha -= 10));
                                        if (alpha < 0)
                                        {
                                                clearInterval(timer);                                                
                                                timer = setInterval(function ()
                                                {
                                                        if(oOuter.offsetHeight >=860)
                                                        {
                                                                css(oOuter,{"height" : (boxHeight -=11)+"px"});
                                                        }
                                                        iHeight -= 10;
                                                        iHeight < 0 && (iHeight = 0);
                                                        css(oParent, "height", iHeight + "px");
                                                        iHeight == 0 && (clearInterval(timer), oUl.removeChild(oParent))
                                                },30)
                                        }        
                                },30);                        
                                this.onclick = null        
                        }                        
                }
        }
        delLi();

        //格式化时间, 如果为一位数时补0
        function format(str)
        {
                return str.toString().replace(/^(\d)$/,"0$1");

        }

        //头像选择。
        for (var k = 0;k<aPortrait.length ;k++ )
        {
                aPortrait[k].onclick = function(){
                        for (var j = 0;j<aPortrait.length ;j++ ){
                                aPortrait[j].className="";
                        }
                        this.className = "current";
                }
        }
}

</script>
 <body>
<div id="outer">
        <form>
        <p id="title">来，说说你在做什么，想什么</p>
        <input type="text" id="usernameField" class="f-text" value='请输入用户名'></input>
        <ul id="portrait">
                <li ><img src="data/attachment/album/201405/28/160441tu3uas77xh88g010.png.thumb.jpg" class="current"></img></li>
                <li><img src="data/attachment/album/201405/28/160439npammflrfp1rjula.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160438qbl7g8aabo879877.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160436rat5p9mah9oa5mhp.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160433cakgdkcracrd7ahh.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160428qi1q8wnfn1n8q888.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/29/091810ai3awsrpns30a03z.jpg.thumb.jpg"></img></li>
        </ul>
        <textarea id="content"   class="f-text"></textarea>
                <div class="broadcast">
                        <input type="button" id="button" value="广 播"></input>
                        <span ><em class="countTxt">还能输入</em><b class="maxNum">140</b>个字</span>
                </div>
                </form>
        <div class="weiboList">
                <h3><span>大家在说</span></h3>
                <ul>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160441tu3uas77xh88g010.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">梁巴斯</a>:</div>
                    <div class="msgInfo">这只是一个模仿微博页面，请不要觉得奇怪。</div>
                    <div class="times"><span>07月05日 15:14</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
            <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160439npammflrfp1rjula.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">小巴斯</a>:</div>
                    <div class="msgInfo">今天天气很好！又可以带小狗出去溜达啦～</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160438qbl7g8aabo879877.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">大巴斯</a>:</div>
                    <div class="msgInfo">一起去玩耍吧～大家等着我！</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160436rat5p9mah9oa5mhp.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">梁先生</a>:</div>
                    <div class="msgInfo">小狗狗好听话，我在看书，它也安静地看我。</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160433cakgdkcracrd7ahh.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">巴斯先生</a>:</div>
                    <div class="msgInfo">今天遇到好多好有趣的人，好好玩！我也好想变成一个好有趣的人，那一定是一件好Beng!的事情！</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160428qi1q8wnfn1n8q888.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">巴斯光年</a>:</div>
                    <div class="msgInfo">每天都要早起去玩！一起来吧～</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/29/091810ai3awsrpns30a03z.jpg.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">胡迪先生</a>:</div>
                    <div class="msgInfo">中午抱着小狗睡着了，它流口水了。我也有流一点，哈哈，不准笑我！</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>

                </ul>
        </div>
</div>

 </body>
</html>



</script>
 <body>
<div id="outer">
        <form>
        <p id="title">来，说说你在做什么，想什么</p>
        <input type="text" id="usernameField" class="f-text" value='请输入用户名'></input>
        <ul id="portrait">
                <li ><img src="data/attachment/album/201405/28/160441tu3uas77xh88g010.png.thumb.jpg" class="current"></img></li>
                <li><img src="data/attachment/album/201405/28/160439npammflrfp1rjula.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160438qbl7g8aabo879877.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160436rat5p9mah9oa5mhp.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160433cakgdkcracrd7ahh.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/28/160428qi1q8wnfn1n8q888.png.thumb.jpg"></img></li>
                <li><img src="data/attachment/album/201405/29/091810ai3awsrpns30a03z.jpg.thumb.jpg"></img></li>
        </ul>
        <textarea id="content"   class="f-text"></textarea>
                <div class="broadcast">
                        <input type="button" id="button" value="广 播"></input>
                        <span ><em class="countTxt">还能输入</em><b class="maxNum">140</b>个字</span>
                </div>
                </form>
        <div class="weiboList">
                <h3><span>大家在说</span></h3>
                <ul>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160441tu3uas77xh88g010.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">梁巴斯</a>:</div>
                    <div class="msgInfo">这只是一个模仿微博页面，请不要觉得奇怪。</div>
                    <div class="times"><span>07月05日 15:14</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
            <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160439npammflrfp1rjula.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">小巴斯</a>:</div>
                    <div class="msgInfo">今天天气很好！又可以带小狗出去溜达啦～</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160438qbl7g8aabo879877.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">大巴斯</a>:</div>
                    <div class="msgInfo">一起去玩耍吧～大家等着我！</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160436rat5p9mah9oa5mhp.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">梁先生</a>:</div>
                    <div class="msgInfo">小狗狗好听话，我在看书，它也安静地看我。</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160433cakgdkcracrd7ahh.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">巴斯先生</a>:</div>
                    <div class="msgInfo">今天遇到好多好有趣的人，好好玩！我也好想变成一个好有趣的人，那一定是一件好Beng!的事情！</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/28/160428qi1q8wnfn1n8q888.png.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">巴斯光年</a>:</div>
                    <div class="msgInfo">每天都要早起去玩！一起来吧～</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>
                        <li>
                <div class="userPic"><img src="data/attachment/album/201405/29/091810ai3awsrpns30a03z.jpg.thumb.jpg" /></div>
                <div class="content">
                    <div class="userName"><a href="javascript:;">胡迪先生</a>:</div>
                    <div class="msgInfo">中午抱着小狗睡着了，它流口水了。我也有流一点，哈哈，不准笑我！</div>
                    <div class="times"><span>07月05日 12:20</span><a class="del" href="javascript:;">删除</a></div>
                </div>
            </li>

                </ul>
        </div>
</div>

 </body>
</html>

